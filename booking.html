<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Booking Acara - UGTV Events</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="stylesheet" href="css/booking.css" />
</head>
<body>
  <!-- HEADER -->
  <header class="navbar">
    <div class="logo"><a href="index.html">üé• UGTV Events</a></div>
  </header>

  <main>
    <section class="form-section">
      <h1>Formulir Booking Acara</h1>

      <form id="bookingForm">
        <label>Nama Lengkap:</label>
        <input type="text" id="nama" required>

        <label>Email:</label>
        <input type="email" id="email" required>

        <label>Jenis Acara:</label>
        <select id="jenis" required>
          <option value="">-- Pilih Jenis Acara --</option>
          <option>Produksi Studio</option>
          <option>Live Broadcast</option>
          <option>Seminar UGTV</option>
        </select>

        <label>Tanggal Acara:</label>
        <input type="date" id="tanggal" required>

        <label>Waktu Mulai:</label>
        <input type="time" id="mulai" required>

        <label>Waktu Selesai:</label>
        <input type="time" id="selesai" required>

        <button type="submit" class="btn-submit">Kirim</button>
      </form>

      <p id="msg-success" class="hidden success">‚úÖ Booking berhasil dikirim!</p>
      <p id="msg-error" class="hidden error"></p>

      <a href="index.html" class="btn-back">‚Üê Kembali ke Halaman Utama</a>
    </section>
  </main>

  <footer>
    <p>¬© 2025 UGTV Events ‚Äî Universitas Gunadarma</p>
  </footer>

  <script>
    const form = document.getElementById("bookingForm");
    const msgSuccess = document.getElementById("msg-success");
    const msgError = document.getElementById("msg-error");

    // Ambil parameter tanggal dari URL (kalau dikirim dari halaman lain)
    const params = new URLSearchParams(window.location.search);
    const tanggalParam = params.get("tanggal");
    if (tanggalParam) document.getElementById("tanggal").value = tanggalParam;

    // Fungsi ambil data booking dari localStorage
    function getBookings() {
      return JSON.parse(localStorage.getItem("bookings") || "[]");
    }

    // Fungsi simpan data booking
    function saveBooking(booking) {
      const bookings = getBookings();
      bookings.push(booking);
      localStorage.setItem("bookings", JSON.stringify(bookings));
    }

    // Cek apakah waktu bentrok di tanggal yang sama
    function isTimeConflict(tanggal, mulai, selesai) {
      const bookings = getBookings();
      return bookings.some(b =>
        b.tanggal === tanggal &&
        !(selesai <= b.mulai || mulai >= b.selesai)
      );
    }

    // Saat form dikirim
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      msgError.classList.add("hidden");
      msgSuccess.classList.add("hidden");

      const nama = document.getElementById("nama").value.trim();
      const email = document.getElementById("email").value.trim();
      const jenis = document.getElementById("jenis").value;
      const tanggal = document.getElementById("tanggal").value;
      const mulai = document.getElementById("mulai").value;
      const selesai = document.getElementById("selesai").value;

      // Validasi email
      if (!/\S+@\S+\.\S+/.test(email)) {
        msgError.textContent = "‚ö†Ô∏è Format email tidak valid.";
        msgError.classList.remove("hidden");
        return;
      }

      // Validasi waktu mulai < selesai
      if (mulai >= selesai) {
        msgError.textContent = "‚ö†Ô∏è Waktu mulai harus lebih awal dari waktu selesai.";
        msgError.classList.remove("hidden");
        return;
      }

      // Cek bentrok jadwal
      if (isTimeConflict(tanggal, mulai, selesai)) {
        msgError.textContent = "‚ùå Waktu tersebut sudah dibooking.";
        msgError.classList.remove("hidden");
        return;
      }

      // Simpan booking ke localStorage
      const bookingData = {
        nama,
        email,
        jenis,
        tanggal,
        mulai,
        selesai,
        status: "Menunggu Konfirmasi",
        waktuInput: new Date().toISOString()
      };

      saveBooking(bookingData);

      // Pesan sukses
      msgSuccess.classList.remove("hidden");
      form.reset();

      // Arahkan ke halaman jadwal setelah 2 detik
      setTimeout(() => {
        window.location.href = "schedule.html";
      }, 2000);
    });
  </script>
</body>
</html>